<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nmsg: fltmod_plugin.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="nmsg.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nmsg
   &#160;<span id="projectnumber">0.13.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_3af54cfecedfb12761767b16ec9023ab.html">nmsg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">fltmod_plugin.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementing message filter modules.  
<a href="#details">More...</a></p>

<p><a href="fltmod__plugin_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnmsg__fltmod__plugin.html">nmsg_fltmod_plugin</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure exported by filter modules.  <a href="structnmsg__fltmod__plugin.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad85c3dae4e511b48df79372f75cf9a01"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#ad85c3dae4e511b48df79372f75cf9a01">NMSG_FLTMOD_VERSION</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:ad85c3dae4e511b48df79372f75cf9a01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Version number of the nmsg fltmod ABI.  <a href="#ad85c3dae4e511b48df79372f75cf9a01">More...</a><br /></td></tr>
<tr class="separator:ad85c3dae4e511b48df79372f75cf9a01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4978661d5fe87d611829f1f81522149f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#a4978661d5fe87d611829f1f81522149f">NMSG_FLTMOD_REQUIRED_INIT</a>&#160;&#160;&#160;.fltmod_version = <a class="el" href="fltmod__plugin_8h.html#ad85c3dae4e511b48df79372f75cf9a01">NMSG_FLTMOD_VERSION</a></td></tr>
<tr class="memdesc:a4978661d5fe87d611829f1f81522149f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convenience macro.  <a href="#a4978661d5fe87d611829f1f81522149f">More...</a><br /></td></tr>
<tr class="separator:a4978661d5fe87d611829f1f81522149f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac65f8a95b4685f0fd4a23eb0cea04507"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#ac65f8a95b4685f0fd4a23eb0cea04507">nmsg_fltmod_module_init_fp</a>) (const void *param, const size_t len_param, void **mod_data)</td></tr>
<tr class="memdesc:ac65f8a95b4685f0fd4a23eb0cea04507"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the filter module.  <a href="#ac65f8a95b4685f0fd4a23eb0cea04507">More...</a><br /></td></tr>
<tr class="separator:ac65f8a95b4685f0fd4a23eb0cea04507"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38d6c1f3b8ac58ad62123b892c56edc9"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#a38d6c1f3b8ac58ad62123b892c56edc9">nmsg_fltmod_module_fini_fp</a>) (void *mod_data)</td></tr>
<tr class="memdesc:a38d6c1f3b8ac58ad62123b892c56edc9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy the filter module.  <a href="#a38d6c1f3b8ac58ad62123b892c56edc9">More...</a><br /></td></tr>
<tr class="separator:a38d6c1f3b8ac58ad62123b892c56edc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a703dbfc506064203472d15cd7888c4cb"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#a703dbfc506064203472d15cd7888c4cb">nmsg_fltmod_thread_init_fp</a>) (void *mod_data, void **thr_data)</td></tr>
<tr class="memdesc:a703dbfc506064203472d15cd7888c4cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize module-defined, thread-wide state.  <a href="#a703dbfc506064203472d15cd7888c4cb">More...</a><br /></td></tr>
<tr class="separator:a703dbfc506064203472d15cd7888c4cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeeb0bd488c46b63298397a99425779c4"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#aeeb0bd488c46b63298397a99425779c4">nmsg_fltmod_thread_fini_fp</a>) (void *mod_data, void *thr_data)</td></tr>
<tr class="memdesc:aeeb0bd488c46b63298397a99425779c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy thread-wide state.  <a href="#aeeb0bd488c46b63298397a99425779c4">More...</a><br /></td></tr>
<tr class="separator:aeeb0bd488c46b63298397a99425779c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1a5488f5ff7d764181ceafaf921b4dd"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fltmod__plugin_8h.html#af1a5488f5ff7d764181ceafaf921b4dd">nmsg_fltmod_filter_message_fp</a>) (nmsg_message_t *msg, void *mod_data, void *thr_data, <a class="el" href="filter_8h.html#a58e7fbf0257050f772b7c1eb6d7a921a">nmsg_filter_message_verdict</a> *vres)</td></tr>
<tr class="memdesc:af1a5488f5ff7d764181ceafaf921b4dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Filter a message object and return the filter verdict.  <a href="#af1a5488f5ff7d764181ceafaf921b4dd">More...</a><br /></td></tr>
<tr class="separator:af1a5488f5ff7d764181ceafaf921b4dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementing message filter modules. </p>
<p>This file defines the interface that developers of message filter modules must implement. For the interface for loading and calling filter modules, see <a class="el" href="fltmod_8h.html" title="Loading and calling external message filter modules. ">nmsg/fltmod.h</a>.</p>
<p>Filter modules are dynamically loaded shared objects that must export a symbol called <code>nmsg_fltmod_plugin_export</code>. This is a structure of type <a class="el" href="structnmsg__fltmod__plugin.html" title="Structure exported by filter modules. ">nmsg_fltmod_plugin</a> and is the sole entry point into the module.</p>
<p>The first field of the <a class="el" href="structnmsg__fltmod__plugin.html" title="Structure exported by filter modules. ">nmsg_fltmod_plugin</a> structure is the version of the API/ABI between libnmsg and the filter module. Module developers should assign this field the value <a class="el" href="fltmod__plugin_8h.html#ad85c3dae4e511b48df79372f75cf9a01" title="Version number of the nmsg fltmod ABI. ">NMSG_FLTMOD_VERSION</a>, or they can add <code>NMSG_FLTMOD_REQUIRED_INIT,</code> to the initializer, which is a convenience macro that initializes required fields.</p>
<p>A filter module needs to provide at least one function, the core message filtering function <code>filter_message</code>. This function must be thread-safe, since it may be called simultaneously from multiple threads.</p>
<p>Optionally, up to four more functions may be provided: a global module initializer and finalizer (<code>module_init</code> and <code>module_fini</code>), and a per-thread initializer and finalizer (<code>thread_init</code> and <code>thread_fini</code>). These functions can be used to acquire and release resources, generate debug messages, etc. The module and thread initializers may provide opaque data pointers. These pointers will be provided as parameters to the message filtering function.</p>
<p>The <code>module_init</code> function will only be called once, immediately after the plugin module has been loaded. It will be called before all other module functions. Therefore, it does not need to be thread-safe.</p>
<p>The <code>module_fini</code> function will only be called once, immediately before the plugin module will be unloaded from the process. It will be called after all other module functions. Therefore, it does not need to be thread-safe, either.</p>
<p>The <code>thread_init</code> and <code>thread_fini</code> functions may be called by a processing thread after the thread has started and before the thread exits. They need to be thread-safe, since they be called by independently executing threads. A thread may not call a module's <code>filter_message</code> function before it has called <code>thread_init</code>, and it may not call <code>filter_message</code> after it has called <code>thread_fini</code>.</p>
<p>For an example of a simple message filtering module, see the "sample" filter module in the fltmod/ directory of the nmsg distribution. The "sample" filter performs either systematic count-based or uniform probabilistic sampling of the message stream. </p>

<p class="definition">Definition in file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad85c3dae4e511b48df79372f75cf9a01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad85c3dae4e511b48df79372f75cf9a01">&#9670;&nbsp;</a></span>NMSG_FLTMOD_VERSION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NMSG_FLTMOD_VERSION&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Version number of the nmsg fltmod ABI. </p>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00074">74</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
<a id="a4978661d5fe87d611829f1f81522149f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4978661d5fe87d611829f1f81522149f">&#9670;&nbsp;</a></span>NMSG_FLTMOD_REQUIRED_INIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NMSG_FLTMOD_REQUIRED_INIT&#160;&#160;&#160;.fltmod_version = <a class="el" href="fltmod__plugin_8h.html#ad85c3dae4e511b48df79372f75cf9a01">NMSG_FLTMOD_VERSION</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convenience macro. </p>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00184">184</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ac65f8a95b4685f0fd4a23eb0cea04507"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac65f8a95b4685f0fd4a23eb0cea04507">&#9670;&nbsp;</a></span>nmsg_fltmod_module_init_fp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(* nmsg_fltmod_module_init_fp) (const void *param, const size_t len_param, void **mod_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the filter module. </p>
<p>Data with module-defined meaning may be passed in via the 'param' and 'len_param' parameters. This can be used to, for example, configure module-specific filtering parameters.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">param</td><td>Module-defined data needed for the initialization of the module.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len_param</td><td>Length of 'param'.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mod_data</td><td>Module-defined, module-wide state, passed to other module functions that take a 'mod_data' parameter.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47a686e6e709e9990bb2375b29ee8ac369c" title="success ">nmsg_res_success</a> If the module was successfully initialized. </dd>
<dd>
Any other result to indicate a fatal error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00099">99</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
<a id="a38d6c1f3b8ac58ad62123b892c56edc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38d6c1f3b8ac58ad62123b892c56edc9">&#9670;&nbsp;</a></span>nmsg_fltmod_module_fini_fp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* nmsg_fltmod_module_fini_fp) (void *mod_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroy the filter module. </p>
<p>Any module-wide resources acquired by the module must be released.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mod_data</td><td>Module-defined, module-wide state. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00111">111</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
<a id="a703dbfc506064203472d15cd7888c4cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a703dbfc506064203472d15cd7888c4cb">&#9670;&nbsp;</a></span>nmsg_fltmod_thread_init_fp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(* nmsg_fltmod_thread_init_fp) (void *mod_data, void **thr_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize module-defined, thread-wide state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mod_data</td><td>Module-defined, module-wide state.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">thr_data</td><td>Module-defined, thread-wide state.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47a686e6e709e9990bb2375b29ee8ac369c" title="success ">nmsg_res_success</a> If the thread-wide state was successfully initialized. </dd>
<dd>
Any other result to indicate a fatal error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00128">128</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
<a id="aeeb0bd488c46b63298397a99425779c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeeb0bd488c46b63298397a99425779c4">&#9670;&nbsp;</a></span>nmsg_fltmod_thread_fini_fp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(* nmsg_fltmod_thread_fini_fp) (void *mod_data, void *thr_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroy thread-wide state. </p>
<p>Any thread-wide resources corresponding to the passed in 'thr_data' value that have been acquired by the module must be released.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mod_data</td><td>Module-defined, module-wide state.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thr_data</td><td>Module-defined, thread-wide state.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47a686e6e709e9990bb2375b29ee8ac369c" title="success ">nmsg_res_success</a> If the thread-wide state was successfully destroyed. </dd>
<dd>
Any other result to indicate a fatal error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00147">147</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
<a id="af1a5488f5ff7d764181ceafaf921b4dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1a5488f5ff7d764181ceafaf921b4dd">&#9670;&nbsp;</a></span>nmsg_fltmod_filter_message_fp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47">nmsg_res</a>(* nmsg_fltmod_filter_message_fp) (nmsg_message_t *msg, void *mod_data, void *thr_data, <a class="el" href="filter_8h.html#a58e7fbf0257050f772b7c1eb6d7a921a">nmsg_filter_message_verdict</a> *vres)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Filter a message object and return the filter verdict. </p>
<p>The filter function may alter the message object, or it may replace the message object with an entirely new message. If the filter function replaces the message object, it is responsible for disposing of the old message, for instance by calling <a class="el" href="message_8h.html#af3019263d039d43fd4ac780408d9faf9" title="Destroy a message object and deallocate any resources associated with it. ">nmsg_message_destroy()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">msg</td><td>Pointer to the message object to be filtered. The message object may optionally be altered, or it may be replaced with an entirely new message object.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mod_data</td><td>Module-defined, module-wide state.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thr_data</td><td>Module-defined, thread-wide state.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">vres</td><td>The filter verdict. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="filter_8h.html#a58e7fbf0257050f772b7c1eb6d7a921a">nmsg_filter_message_verdict</a> for the possible verdict results and meanings.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="res_8h.html#a521756a76fc3efbb2b8fb2b631b87b47a686e6e709e9990bb2375b29ee8ac369c" title="success ">nmsg_res_success</a> The filtering completed and returned a verdict in 'vres'. </dd>
<dd>
Any other result to indicate a fatal error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fltmod__plugin_8h_source.html#l00178">178</a> of file <a class="el" href="fltmod__plugin_8h_source.html">fltmod_plugin.h</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
